<h2 mat-dialog-title>Mouvement de stock</h2>
<mat-dialog-content fxLayout="column">

    <natural-select-enum enumName="StockMovementTypeForCreate"
                         placeholder="Type du mouvement"
                         [(ngModel)]="stockMovement.type"
                         (selectionChange)="update()"
    ></natural-select-enum>

    <mat-form-field *ngIf="stockMovement.type !== inventory">
        <mat-label>Quantité du mouvement</mat-label>
        <input matInput
               [(ngModel)]="delta"
               type="number"
               required="required"
               step="0.001"
               min="0"
               oninput="validity.valid||(value='');"
               (ngModelChange)="update()"
        />
        <div matSuffix>{{ data.product.unit }}</div>
    </mat-form-field>

    <mat-form-field *ngIf="stockMovement.type === inventory">
        <mat-label>Quantité totale en stock actuellement</mat-label>
        <input matInput
               [(ngModel)]="quantity"
               type="number"
               required="required"
               step="0.001"
               min="0"
               oninput="validity.valid||(value='');"
               (ngModelChange)="update()"
        />
        <div matSuffix>{{ data.product.unit }}</div>
        <mat-hint>Saisir la quantité <strong>totale</strong> en stock</mat-hint>
    </mat-form-field>

    <mat-form-field *ngIf="data.product.unit" style="margin-bottom:20px">
        <mat-label>Poids du récipient</mat-label>
        <input matInput
               [(ngModel)]="containerWeight"
               type="number"
               step="0.001"
               min="0"
               (ngModelChange)="update()"
               oninput="validity.valid||(value='');"
        />
        <div matSuffix>{{ data.product.unit }}</div>
        <mat-hint>Ne remplir que lorsque le récipient a été pesé avec la marchandise</mat-hint>
    </mat-form-field>

    <mat-error *ngIf="!isWeightRespected()" class="margin-v" fxLayout="row" fxLayoutAlign="center center">
        <natural-icon name="warning"></natural-icon>
        La quantité ne peut être inférieure au poids du récipient
    </mat-error>

    <mat-form-field style="width:100%">
        <mat-label>Remarques</mat-label>
        <textarea matInput [(ngModel)]="stockMovement.remarks" matTextareaAutosize [matAutosizeMinRows]="3"></textarea>
    </mat-form-field>

</mat-dialog-content>

<mat-dialog-actions>
    <button mat-button mat-dialog-close>Annuler</button>
    <button mat-flat-button
            color="primary"
            [disabled]="!stockMovement.delta || lockedButtons || !isWeightRespected()"
            (click)="create(stockMovement)"
    >
        Valider
    </button>
    <button mat-flat-button
            color="primary"
            [disabled]="!stockMovement.delta || lockedButtons || !isWeightRespected()"
            (click)="create(stockMovement); verify()"
    >
        Valider et marquer "Vérifié"
    </button>
</mat-dialog-actions>
