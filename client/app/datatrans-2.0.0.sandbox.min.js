(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof module==="object"&&module.exports){module.exports=b()}else{a.Datatrans=b()}}}(typeof self!=="undefined"?self:this,function(){var i=function(p,o){var n={};var q;for(q in p){if(Object.prototype.hasOwnProperty.call(p,q)){n[q]=p[q]}}for(q in o){if(Object.prototype.hasOwnProperty.call(o,q)){n[q]=o[q]}}return n};var m=function(n,o){var p=document.createElement(n);if(!o){return p}Object.keys(o).forEach(function(q){p.setAttribute(q,o[q])});return p};var f=function(n){return Array.prototype.slice.call(n.attributes).filter(function(o){return o.name.indexOf("data-")===0}).reduce(function(o,q){var p=q.name.replace(/^data-/,"").replace(/-([a-z])/g,function(r){return r[1].toUpperCase()});o[p]=q.value;return o},{})};var d=function(n,o){if((n.length>0)&&typeof o==="object"){return undefined}return o};var l={html:{width:"100%",height:"100%",overflow:"hidden"},body:{width:"100%",height:"100%",overflow:"visible",position:"fixed"}};var g={};var b=function(q){var r=document.documentElement;var p=document.body;var o=r.getAttribute("data-datatrans-payment-lock")||"unlocked";var n=q!==undefined?q:o==="unlocked";var s;if(n){r.setAttribute("data-datatrans-payment-lock","locked");s=p.scrollTop;g={html:r.getAttribute("style"),body:p.getAttribute("style")};Object.keys(l.html||{}).forEach(function(t){r.style[t]=l.html[t]});Object.keys(l.body||{}).forEach(function(t){p.style[t]=l.body[t]});p.style.top=-s}else{s=-(parseInt(p.style.top,10));r.setAttribute("style",g.html);p.setAttribute("style",g.body);p.scrollTop=s;p.style.top="";r.setAttribute("data-datatrans-payment-lock","unlocked")}};var j;var e;var k;var c;var h=function(s){c=function(){b(false);e.parentNode.removeChild(e);j.parentNode.removeChild(j);if(window.removeEventListener){window.removeEventListener("message",k)}else{if(window.detachEvent){window.detachEvent("message",k)}}};b();if(typeof s.opened==="function"){s.opened()}var t={};if(s.form!==undefined){var q=document.querySelector(s.form);if(q){q.addEventListener("submit",function(z){z.preventDefault()});t=f(q)}}if(t!==undefined){t=i(t,s.params)}t.theme="DT2015";t.version=datatransPaymentConfig.version;var u=datatransPaymentConfig.endpoint+"/upp/jsp/upStart.jsp";var n="post";if(s.paymentId!==undefined){u=datatransPaymentConfig.endpoint+"/upp/v1/start/"+s.paymentId;n="get"}var x=false;var y=t.paymentmethod;var o=u+"?";if(y&&y.indexOf(",")===-1){if(datatransPaymentConfig.fullscreenMethods.indexOf(y)!==-1){x=true}}x=x||a();if(!x){e=m("form",{id:"datatransPaymentForm",name:"datatransPaymentForm",method:n,style:"display: none;",action:u,target:"datatransPaymentFrame"});for(var p in t){if(p==="paymentmethod"){var v=t[p];if(!v){continue}if(v.indexOf(",")!==-1){v.split(",").forEach(function(z){e.appendChild(m("input",{type:"hidden",name:p,value:z}))});continue}}if(typeof t[p]==="object"){e.appendChild(m("input",{type:"hidden",name:p,value:JSON.stringify(t[p],d)}))}else{e.appendChild(m("input",{type:"hidden",name:p,value:t[p]}))}}if(!t.uppReturnTarget){e.appendChild(m("input",{type:"hidden",name:"uppReturnTarget",value:"_top"}))}j=m("div",{id:"paymentFrameWrapper",style:"z-index: 9999; position: fixed; right: 0; bottom: 0; left: 0; top: 0; overflow: hidden; -webkit-transform: translate3d(0, 0, 0); display: none"});j.appendChild(m("iframe",{id:"datatransPaymentFrame",name:"datatransPaymentFrame",frameborder:"0",allowtransparency:"true",style:"border: 0; margin: 0; padding: 0; width: 100%; height: 100%; -webkit-transform: translate3d(0, 0, 0);"}));e.appendChild(m("input",{type:"hidden",name:"mode",value:"lightbox"}));document.body.appendChild(j);document.body.appendChild(e)}else{var r=[];for(var w in t){if(typeof t[w]==="object"){r.push(w+"="+encodeURIComponent(JSON.stringify(t[w],d)))}else{if(w==="paymentmethod"){var v=t[w];if(!v){continue}v.split(",").forEach(function(z){r.push(w+"="+encodeURIComponent(z))})}else{r.push(w+"="+encodeURIComponent(t[w]))}}}o+=r.join("&")}k=function(z){if(z.origin!==datatransPaymentConfig.endpoint){return}if(z.data==="cancel"){if(typeof s.closed==="function"){s.closed()}c();return}if(z.data==="frameReady"){if(typeof s.loaded==="function"){s.loaded()}j.style.display="block";return}if(typeof z.data==="object"&&z.data.type==="error"){if(typeof s.error==="function"){var A={message:z.data.message,detail:z.data.detail};s.error(A)}c();return}};if(window.addEventListener){window.addEventListener("message",k)}else{if(window.attachEvent){window.attachEvent("message",k)}}if(x){location.href=o}else{e.submit()}};var a=function(){if(typeof window.matchMedia==="function"&&window.matchMedia("(display-mode: standalone)").matches){return true}if(window.navigator.standalone===true){return true}return false};return{startPayment:h,close:function(){if(typeof c==="function"){c()}}}}));

var datatransPaymentConfig = {"endpoint":"https://pay.sandbox.datatrans.com","version":"2.0.0","fullscreenMethods":["PAP","CUR","SAM","INT","PFC","SWB","TWI","PSC","CFY","REK"]};
