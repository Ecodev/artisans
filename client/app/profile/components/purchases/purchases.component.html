@if (dataSource) {
    <div class="nat-vertical nat-gap-30">
        <h2 class="mat-headline-4 nat-no-margin-bottom">Articles achetés</h2>
        <div class="nat-vertical nat-gap">
            <div class="nat-margin-vertical overflow nat-horizontal">
                <natural-search
                    (selectionChange)="search($event)"
                    [multipleGroups]="false"
                    [selections]="naturalSearchSelections"
                    class="nat-expand"
                />
            </div>
            <div [class.nat-show]="dataSource.data?.length > 0" class="responsive-table nat-gap-30 nat-vertical">
                @for (orderLine of dataSource.data?.items; track orderLine) {
                    <div class="product nat-gap nat-horizontal">
                        @if (orderLine.product.image) {
                            <a class="product-image" [routerLink]="['/larevuedurable/article', orderLine.product.id]">
                                <img
                                    [naturalSrcDensity]="'/api/image/' + orderLine.product.image.id + '/90'"
                                    alt="aperçu du produit"
                                />
                            </a>
                        }
                        <div class="nat-expand nat-gap-5 nat-vertical nat-top nat-left">
                            <div
                                class="nat-horizontal mat-body nat-no-margin-bottom text-light nat-gap-15 nat-left nat-baseline"
                            >
                                @if (orderLine.product.reviewNumber) {
                                    <span class="text-primary"> N° {{ orderLine.product.reviewNumber }}</span>
                                }
                                @if (orderLine.product.releaseDate) {
                                    <span>
                                        {{ orderLine.product.releaseDate | date: 'MMMM yyyy' | capitalize }}
                                    </span>
                                }
                                <span>{{ orderLine.type | enum: 'ProductType' | async }}</span>
                            </div>
                            <a
                                [routerLink]="['/larevuedurable/article', orderLine.product.id]"
                                matRipple
                                class="mat-h3"
                            >
                                {{ orderLine.product.name }}
                            </a>
                            @if (canDownload(orderLine)) {
                                <a mat-stroked-button color="accent" [href]="getDownloadLink(orderLine)">
                                    <mat-icon naturalIcon="get_app" />
                                    Télécharger
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
            @if (dataSource.data?.length === 0) {
                <div class="nat-margin nat-vertical nat-center">
                    <div>Pas de résultats</div>
                </div>
            }
            @if (!dataSource.data) {
                <div class="nat-margin nat-vertical nat-center">
                    <mat-progress-spinner [diameter]="40" mode="indeterminate" />
                </div>
            }
            @if (dataSource.data?.length) {
                <mat-paginator
                    (page)="pagination($event)"
                    [length]="dataSource.data?.length"
                    [pageIndex]="dataSource.data?.pageIndex"
                    [pageSizeOptions]="[25]"
                    [pageSize]="25"
                />
            }
        </div>
    </div>
}
